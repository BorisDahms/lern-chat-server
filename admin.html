<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernkarten-Verwaltung</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f7f7f7; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; }
        select, input[type="text"], input[type="url"] { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { padding: 10px 15px; border: none; border-radius: 5px; background-color: #007bff; color: white; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        .card-list { margin-top: 20px; }
        .card-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border: 1px solid #eee; border-radius: 5px; margin-bottom: 10px; }
        .card-item-content { flex-grow: 1; }
        .card-item-actions button { margin-left: 10px; background-color: #6c757d; font-size: 0.8rem; padding: 5px 10px;}
        .card-item-actions .delete-btn { background-color: #dc3545; }
    </style>
</head>
<body>

<div class="container">
    <h1>Lernkarten-Verwaltung (Admin)</h1>

    <div id="topic-management">
        <h2>Thema auswählen</h2>
        <select id="topic-select" onchange="displayCardsForTopic()"></select>
    </div>

    <hr>

    <div id="card-management">
        <h2>Karten des Themas</h2>
        <div id="cards-container" class="card-list">
            <p>Bitte wählen Sie oben ein Thema aus.</p>
        </div>
    </div>
</div>

<script>
    // Dieselbe Firebase Konfiguration wie in der Lern-App
    const firebaseConfig = {
        apiKey: "AIzaSyCiRssR2sKAyZh6dwoozrtRAHi-lCNDMtM",
        authDomain: "lernkarten-801e2.firebaseapp.com",
        databaseURL: "https://lernkarten-801e2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "lernkarten-801e2",
        storageBucket: "lernkarten-801e2.appspot.com",
        messagingSenderId: "170901842419",
        appId: "1:170901842419:web:07c8196da0317da7824a86"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let allData = {}; // Speichert alle Themen und Karten
    const topicSelect = document.getElementById('topic-select');
    const cardsContainer = document.getElementById('cards-container');

    // 1. LÄDT ALLE DATEN AUS FIREBASE, WENN DIE SEITE STARTET
    function loadInitialData() {
        database.ref('themen').once('value').then((snapshot) => {
            allData = snapshot.val();
            populateTopicSelector();
            displayCardsForTopic(); // Zeigt Karten für das erste Thema an
        }).catch(error => {
            console.error("Fehler beim Laden der Daten:", error);
            alert("Daten konnten nicht geladen werden.");
        });
    }

    // 2. FÜLLT DAS DROPDOWN-MENÜ MIT ALLEN THEMEN
    function populateTopicSelector() {
        topicSelect.innerHTML = ''; // Leert alte Einträge
        for (const topicKey in allData) {
            const option = document.createElement('option');
            option.value = topicKey;
            option.innerText = allData[topicKey].displayName;
            topicSelect.appendChild(option);
        }
    }

    // 3. ZEIGT DIE KARTEN FÜR DAS AUSGEWÄHLTE THEMA AN
    function displayCardsForTopic() {
        const selectedTopicKey = topicSelect.value;
        const topic = allData[selectedTopicKey];
        cardsContainer.innerHTML = ''; // Leert die alte Kartenliste

        if (!topic || !topic.cards) {
            cardsContainer.innerHTML = '<p>Für dieses Thema wurden noch keine Karten angelegt.</p>';
            return;
        }

        // Firebase speichert Arrays als Objekte, daher umwandeln
        const cards = Array.isArray(topic.cards) ? topic.cards : Object.values(topic.cards);

        cards.forEach((card, index) => {
            if (!card) return; // Überspringt leere Einträge

            const cardElement = document.createElement('div');
            cardElement.className = 'card-item';
            
            // Inhalt der Karte (Frage und Bild-URL)
            cardElement.innerHTML = `
                <div class="card-item-content">
                    <strong>Frage:</strong> ${card.question}<br>
                    <small><strong>Bild-URL:</strong> ${card.bildUrl || 'Keine URL angegeben'}</small>
                </div>
                <div class="card-item-actions">
                    <button class="edit-btn">Bearbeiten</button>
                    <button class="delete-btn">Löschen</button>
                </div>
            `;
            cardsContainer.appendChild(cardElement);
        });
    }

    // STARTPUNKT: Die App wird geladen, wenn die Seite bereit ist
    document.addEventListener('DOMContentLoaded', loadInitialData);

</script>

</body>
</html>